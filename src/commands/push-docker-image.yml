description: >
  Push a Docker image to the Heroku Docker registry.
parameters:
  app-name:
    description:
      The name of your Heroku app. May also refer to an environment variable.
    type: string
    default: $HEROKU_APP_NAME
  process-types:
    description: Process types.
    type: string
    default: ""
  recursive:
    description: Push all Dockerfiles in the directory to Heroku.
    type: boolean
    default: false
  api-key:
    description: The name of the environment variable containing your Heroku API Key.
    type: env_var_name
    default: HEROKU_API_KEY
  no_output_timeout:
    type: string
    description:
      "Allows you to specify the no_output_timeout for the `git push` to heroku. Defaults to 10m."
    default: "10m"
  context-path:
    type: string
    default: ""
    description: Path to use as build context (defaults to Dockerfile dir)
steps:
  - run:
      name: Login to Heroku Docker image registry
      command: heroku container:login
  - run:
      no_output_timeout: << parameters.no_output_timeout >>
      name: Push Docker image to Heroku
      environment:
        PARAM_APP_NAME: <<parameters.app-name>>
        PARAM_HEROKU_API_KEY: <<parameters.api-key>>
        PARAM_PROCESS_TYPES: <<parameters.process-types>>
        PARAM_RECURSIVE: <<parameters.recursive>>
        PARAM_CONTEXT_PATH: <<parameters.context-path>>
      command: <<include(scripts/push-docker-image.sh)>>
