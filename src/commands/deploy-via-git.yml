description: >
  Replace this text with a description for this command.
  # What will this command do?
  # Descriptions should be short, simple, and clear.
parameters:
  app-name:
    description:
      "The name of your Heroku App.
      For backwards compatibility the literal value
      `$HEROKU_APP_NAME` is the default, so you can
      easily use this command by setting an environment
      variable called HEROKU_APP_NAME"
    type: string
    default: $HEROKU_APP_NAME
  maintenance-mode:
    description:
      "Use this to automatically enable maintenance mode before pre-deploy steps
        and have it disabled after post-deploy steps have been run."
    type: boolean
    default: false
  api-key:
    description:
      "The API key to use. defaulting to the literal value $HEROKU_API_KEY, so you can
      populate the environment variable HEROKU_API_KEY and not need to declare a value in code."
    type: string
    default: $HEROKU_API_KEY
  branch:
    type: string
    description:
      Deploy the given branch. The default value is your current branch.
    default: "$CIRCLE_BRANCH"
  force:
    type: boolean
    description: "Whether or not to force the git push (i.e. `git push -f`). Defaults to false."
    default: false
  only-branch:
    type: string
    description:
      "If you specify an only-branch, the deploy will not occur for any other branch. The default value,
      an empty string, will result in the command running for all branches.
      This is here mostly because for people moving from CircleCI 1.0 setting up a workflow
      with branch filters may be more than they want to do, and this is a convenient way to filter
      out deploys for all but one branch (a typical use would be to pass `master` as the value)."
    default: ""
  no_output_timeout:
    type: string
    description:
      "Allows you to specify the no_output_timeout for the `git push` to heroku. Defaults to 10m."
    default: "10m"
steps:
  - when:
      condition: << parameters.maintenance-mode >>
      steps:
        - run: heroku maintenance:on --app << parameters.app-name >>
  - run:
      no_output_timeout: << parameters.no_output_timeout >>
      name: Deploy branch to Heroku via git push
      command: |
        if << parameters.force >>;then
          force="-f"
        fi
        if [[ "<< parameters.only-branch >>" == "" ]] || [[ "${CIRCLE_BRANCH}" == "<< parameters.only-branch >>" ]]; then
          git push $force https://heroku:<< parameters.api-key >>@git.heroku.com/<< parameters.app-name >>.git << parameters.branch >>:master
        fi
  - when:
      condition: << parameters.maintenance-mode >>
      steps:
        - run: heroku maintenance:off --app << parameters.app-name >>